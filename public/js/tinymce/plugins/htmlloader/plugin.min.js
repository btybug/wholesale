tinymce.PluginManager.add('htmlloader', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('htmlloader', {
        text: 'HTML',
        icon: false,
        onclick: function() {
            $('[data-target="#myModal"]').click();
            // $('[aria-label="Insert template"] .mce-last').click();
            var parser = new tinymce.html.DomParser({validate: true});
            $('.open-btn[bb-media-click="open_images"]').on('click', function(ev) {
                // var rootNode = new tinymce.html.DomParser.parse('<b>text</b>');
                //     editor.insertContent('Title: ' + '<iframe src="http://e-cigar.com/public/media/html/c3cbadcb214816e8c706ba08240bbbe7.html"></iframe>');
                $.ajax({
                    type: "get",
                    url: $(this).closest('#myModal').find('.image-container.active img').attr('src'),
                    cache: false,
                    data: 1,
                    headers: {
                        "X-CSRF-TOKEN": $("meta[name='csrf-token']").attr("content")
                    },
                    success: function (data) {
                        var rootNode = parser.parse(data)

                        editor.setContent(data,{format : 'raw'})

                        // editor.execCommand('mceInsertTemplate', false,
                        //     {
                        //     content : data,
                        //     selection : editor.selection.getContent()
                        // }
                        // );
                        editor.selection.getNode().setAttribute("data-mce-resize", "5")
                        console.log(editor.selection.controlSelection.isResizable(editor.selection.getNode()), rootNode)
                        editor.selection.controlSelection.showResizeRect(editor.selection.getNode())

                        // editor.setContent(rootNode)


                        // editor.addVisual(data)
                        // alert('end')
                    }
                });
                })
            // $.ajax({
            //     type: "get",
            //     url: "http://e-cigar.com/public/media/html/47881dc997dbde3b86692d7549ed482f.html",
            //     cache: false,
            //     data: 1,
            //     headers: {
            //         "X-CSRF-TOKEN": $("meta[name='csrf-token']").attr("content")
            //     },
            //     success: function (data) {
            //
            //         editor.setContent(data)
            //         console.log(data)
            //         // editor.addVisual(data)
            //         // alert('end')
            //     }
            // });

            // $('.open-btn[bb-media-click="open_images"]').on('click', function(ev) {
            //     editor.insertContent('Title: ' + '<iframe src="http://e-cigar.com/public/media/html/c3cbadcb214816e8c706ba08240bbbe7.html"></iframe>');
            // });

            // $('.image-container.active')
            // editor.insertContent('Title: ' + '<h1>hello</h1>');
            // Open window
            // editor.windowManager.open({
            //     title: 'ht plugin',
            //     body: [
            //         {type: 'textbox', name: 'title', label: 'Title'}
            //     ],
            //     onclick: () => alert('hello'),
            //     onsubmit: function(e) {
            //         // Insert content when the window form is submitted
            //
            //         editor.insertContent('Title: ' + '<h1>hello</h1>');
            //     }
            // });
        }
    });

    // Adds a menu item to the tools menu
    editor.addMenuItem('htmlloader', {
        text: 'ht plugin',
        context: 'tools',
        onclick: function() {
            // Open window with a specific url
            editor.windowManager.open({
                title: 'TinyMCE site',
                url: 'https://www.tinymce.com',
                width: 800,
                height: 600,
                buttons: [{
                    text: 'Close',
                    onclick: 'close'
                }]
            });
        }
    });

    return {
        getMetadata: function () {
            return  {
                name: "htmlloader plugin",
                url: "http://exampleplugindocsurl.com"
            };
        }
    };
});
